<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Rose</title>
		<!-- Stylesheets -->
		<link href='http://fonts.googleapis.com/css?family=Cabin:500' rel='stylesheet' type='text/css'>
    	<link rel="stylesheet" type="text/css" href="/css/rose.css">
    	<!-- Libraries -->
		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js"></script>
		<!-- Scripts -->
		<script type="text/javascript" src="rose.js"></script>
    </head>
	<body>
		<button><a href='age.html'>age</a></button>
		<!--<h1>Nightingale's Rose</h1>-->
		<!-- Inspiration: http://mbostock.github.io/protovis/ex/crimea-rose.html http://understandinguncertainty.org/node/213 http://bl.ocks.org/kgryte/5926740
		-->
		<script type="text/javascript">
			var rose = Chart.rose(),
				roseHeight = 600,
				format = d3.time.format('%B'),
				causes = ['Direct', 'Agency', 'Air Crews'];//,
				labels = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];

			// Add sub-titles:
			d3.select('body').append('h3')
				.attr('class', 'subtitle right')
				.html('Reservation');

			// Parse the date / time
			var parseDate = d3.time.format("%B").parse;

			d3.csv('/csv/hotel.csv', function(error, data) {
				// Format the date and rework the data:
				if (error)throw error;
				
				var scalar;
				data.forEach(function(d, i) { 
					//d.date = format.parse(i);
					d.label = d.label;//labels[d.date.getMonth()];
					// Calculate the average annual mortality, as done by Nightingale:
					// http://understandinguncertainty.org/node/214 
					scalar = d.occupancy;
					d.DR = d.DR * scalar;
					d.agency  = d.agency  * scalar;
					d.AC   = d.AC   * scalar;
				});

				// Get the maximum value:
				var maxVal = d3.max(data, function(d) {
					return d3.max([d.DR, d.agency, d.AC]);
				});

				// Where the maximum value gives us the maximum radius:
				var maxRadius = Math.sqrt(maxVal*12 / Math.PI);

				// Divide the dataset in two:
				/*var dataset2 = data.slice(12,24),
					dataset1 = data.slice(0,12);
				*/
				var dataset1 = data, dataset2 = data;
				// Append a new figure to the DOM:
				figure = d3.select('body')
					.append('figure');

				// Get the figure width:
				width = parseInt(figure.style('width'), 10);

				// Update the chart generator settings:
				rose.legend(causes)
					.width(width)
					.height(roseHeight/2+40)
					.delay(0)
					.duration(500)
					.domain([0, maxRadius])
					.angle(function(d, i) { return i; })
					.area(function(d, i) { return [d.DR, d.agency, d.AC]; });							

				// Bind the data and generate a new chart:
				figure.datum(dataset1)
					.attr('class', 'chart figure2')
					.call(rose);	

				// Append a new figure to the DOM:
				figure = d3.select('body')
					.append('figure');

				// Get the figure width:
				width = parseInt(figure.style('width'), 10);

				// Update the chart generator settings:
				rose.width(width)
					.delay(3000);
        
        // Create a legend:
				Chart.legend(causes);

				// Create a slider:
				Chart.slider(0, data.length, 1); // minVal, maxVal, step
       });	

		</script>
	</body>
</html>